---
title: "Compare Performance"
author: "Poornima Belavadi, Nils Plettenberg, Johannes Nakayama, Andr√© Calero Valdez"
date: "3/12/2020"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_float: true
    code_folding: hide
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(glue)
library(here)
source(here("R", "our_theme.R"))
theme_set(theme_bw() + my_theme)
```


# Benchmarking gghilbertstrings

## Setup of the comparison

First, we load the required packages and create a tibble that contains the data to visualize.

```{r benchmark_prep}
if (FALSE) {
  if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
  
  BiocManager::install("HilbertCurve")
}

library(microbenchmark)
library(HilbertCurve)
library(gghilbertstrings)

df <- tibble(val = 1:256,
             size = runif(256, 1, 5),
             # create random sizes
             color = rep(c(1, 2, 3, 4), 64))

reps <- 1000 #takes about 50 seconds on iMac i9 3.5GHz
```

This is the data that we use for the visualization.

```{r benchmark_prep_data}
df
```


## Running the benchmark
We run the creation of a coordinate system `r reps` times.

```{r benchmark, echo=TRUE, results='hide', class.source = 'fold-show'}
# Compare the creation of coordinate systems
mb <- microbenchmark(times = reps,
                     HilbertCurve = {
                       hc <- HilbertCurve(1, 256, level = 4, newpage = FALSE)
                     },
                     gghilbertstrings = {
                       ggh <- hilbertd2xy(n = 2 ^ 8, df$val)
                     })
```


# What is being tested here?

## gghilbertstrings

```{r show_plot, echo=TRUE, results='hide', class.source = 'fold-show'}
gghilbertplot(df,
              val,
              color = factor(color),
              size = size,
              add_curve = TRUE) +
  coord_fixed()
```

## HilbertCurve

```{r show_plot2, echo=TRUE, results='hide', class.source = 'fold-show'}
hc <- HilbertCurve(1, 256, reference = TRUE)
hc_points(hc, x1 = df$val, 
          gp = gpar(fill = c("white", "red", "blue", "green")))
```



# Plotting the results



```{r benchmark_plot, message=FALSE, warning=FALSE}
autoplot(mb) +
  coord_flip() +
  ggtitle(
    glue("Comparison of runtime performance using {reps} repetions on 4 levels")
    ) +
  labs(caption = "X-Axis on log-scale") +
  theme_bw()
```

## Results as a table
Values are microseconds.

```{r benchmark2}

mb %>% 
  summary() %>% 
  as_tibble() 
```
